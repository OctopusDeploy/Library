{
  "Id": "51536440-5e87-4cc7-a254-acb673f9c2c8",
  "Name": "Apollo Rover - Publish Subgraph Schema",
  "Description": "Publish subgraph schema to Apollo Studio. This should be run after successfully deploying a subgraph service.\n\nThe script installs the [Apollo Rover CLI](https://apollographql.com/docs/rover) and runs the `rover subgraph publish` command.",
  "ActionType": "Octopus.Script",
  "Version": 1,
  "CommunityActionTemplateId": null,
  "Packages": [
    {
      "Name": "Schema Package",
      "PackageId": null,
      "FeedId": "feeds-builtin",
      "AcquisitionLocation": "Server",
      "Properties": {
        "Extract": "True",
        "SelectionMode": "deferred",
        "PackageParameterName": "ApolloSchemaPackage",
        "Purpose": ""
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptSource": "Inline",
    "Octopus.Action.Script.Syntax": "Bash",
    "Octopus.Action.Script.ScriptBody": "ROVER_VERSION=$(get_octopusvariable \"ApolloRoverVersion\")\n[ -z \"$ROVER_VERSION\" ] || [ \"$ROVER_VERSION\" == \"latest\" ] && ROVER_VERSION=\"latest\" || ROVER_VERSION=\"v$ROVER_VERSION\"\n\ncurl -sSL https://rover.apollo.dev/nix/$ROVER_VERSION | sh\n\nexport APOLLO_KEY=$(get_octopusvariable \"ApolloKey\")\n\nrover subgraph publish $(get_octopusvariable \"ApolloGraphRef\") \\\n  --name $(get_octopusvariable \"ApolloSubgraphName\") \\\n  --routing-url $(get_octopusvariable \"ApolloSubgraphUrl\") \\\n  --schema $(get_octopusvariable \"ApolloSchema\")\n"
  },
  "Parameters": [
    {
      "Name": "ApolloRoverVersion",
      "Label": "Apollo Rover Version",
      "HelpText": "The version of the Apollo Rover CLI to use for running `rover subgraph publish`.\nMay be either semver (i.e. `0.19.1`), `latest`, or empty",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "ApolloKey",
      "Label": "Apollo Key",
      "HelpText": "The API key to Apollo Studio",
      "DefaultValue": "#{APOLLO_KEY}",
      "DisplaySettings": {
        "Octopus.ControlType": "Sensitive"
      }
    },
    {
      "Name": "ApolloGraphRef",
      "Label": "Apollo Graph Ref",
      "HelpText": "The Apollo Studio graph variant",
      "DefaultValue": "#{APOLLO_GRAPH_REF}",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "ApolloSubgraphName",
      "Label": "Subgraph Name",
      "HelpText": "The name of the subgraph",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "ApolloSubgraphUrl",
      "Label": "Subgraph Url",
      "HelpText": "The graphql endpoint url for the subgraph",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "ApolloSchemaPackage",
      "Label": "Schema Package",
      "HelpText": "The package containing the schema file",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "Package"
      }
    },
    {
      "Name": "ApolloSchema",
      "Label": "Schema",
      "HelpText": "The path to the schema file",
      "DefaultValue": "./schema.graphql",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    }
  ],
  "StepPackageId": "Octopus.Script",
  "$Meta": {
    "ExportedAt": "2023-10-23T18:58:06.459Z",
    "OctopusVersion": "2023.4.4265",
    "Type": "ActionTemplate"
  },
  "LastModifiedBy": "parkerholladay",
  "Category": "apollo"
}
